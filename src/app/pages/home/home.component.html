<div class="home-container">
  <mat-card class="home-card" *ngIf="userData">
    <mat-card-content>
      <!-- Header Section -->
      <div class="welcome-section">
        <h1 class="welcome-title">¡Bienvenido, {{ userData.user?.firstName }}!</h1>
        <p class="welcome-subtitle">Panel de control de tickets</p>
      </div>


      <div class="main-content">
        <div class="left-section">
          <div class="user-profile-card">
            <div class="profile-header">
              <div class="img-container">
                <img [src]="imgAvatar" alt="Avatar del usuario" (click)="confirmChangeAvatar()"
                  style="cursor: pointer;" matTooltip="Clic para cambiar imagen" />
              </div>
              <div class="profile-info">
                <h2>{{ userFullName }}</h2>
                <p class="user-role">{{ userData.user?.role }}</p>
                <p class="user-email">
                  <mat-icon>email</mat-icon>
                  <a href="mailto:{{ userData.user?.email }}">{{ userData.user?.email }}</a>
                </p>
                <div class="star-rating" *ngIf="isAgentOrAdmin">
                  <mat-icon>star_rate</mat-icon>
                  <span class="rating-text">Calificación:</span>
                  <ng-container *ngFor="let star of getStars(userData.user?.rating)">
                    <mat-icon [class]="'star-' + (star.filled ? 'filled' : star.half ? 'half' : 'empty')">
                      {{ star.filled ? 'star' : star.half ? 'star_half' : 'star_border' }}
                    </mat-icon>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>

          <!-- Departments Card -->
          <div class="departments-card" *ngIf="hasDepartments">
            <div class="card-header">
              <mat-icon>business</mat-icon>
              <h3>Departamentos</h3>
            </div>
            <div class="departments-content">
              <mat-chip-list>
                <mat-chip *ngFor="let department of departments" color="primary">
                  {{ department.name }} - {{ getOrganization(department.organization)?.name }}
                </mat-chip>
              </mat-chip-list>
            </div>
          </div>
        </div>

        <!-- Right Section: Stats & Actions -->
        <div class="right-section">
          <div class="stats-grid">
            <div class="stat-card" *ngIf="isAgentOrAdmin">
              <div class="stat-icon"><mat-icon>assessment</mat-icon></div>
              <div class="stat-content">
                <h3>Tickets evaluados</h3>
                <p class="stat-number">{{ userData.user?.evaluatedTickets }}</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><mat-icon>check_circle</mat-icon></div>
              <div class="stat-content">
                <h3>Tickets cerrados</h3>
                <p class="stat-number">{{ userData.user?.closedTickets }}</p>
              </div>
            </div>
          </div>

          <!-- Actions Card -->
          <div class="actions-card">
            <div class="card-header">
              <mat-icon>dashboard</mat-icon>
              <h3>Accesos rápidos</h3>
            </div>
            <div class="actions-grid">
              <button class="action-button" routerLink="/tickets/my-open-ones" mat-raised-button>
                <mat-icon>open_in_new</mat-icon><span>Mis tickets abiertos</span>
              </button>
              <button class="action-button" routerLink="/tickets/my-closed-ones" mat-raised-button>
                <mat-icon>check_circle</mat-icon><span>Mis tickets cerrados</span>
              </button>
              
              <!-- Department Actions (conditional) -->
              <ng-container *ngIf="isNotUserOrDirector">
                <button class="action-button" routerLink="/tickets/new" mat-raised-button>
                  <mat-icon>assignment</mat-icon><span>Tickets del departamento</span>
                </button>
                <button class="action-button" routerLink="/tickets/closed" mat-raised-button>
                  <mat-icon>archive</mat-icon><span>Tickets cerrados depto.</span>
                </button>
              </ng-container>
              
              <button class="action-button primary-button" (click)="addTicket()" mat-raised-button>
                <mat-icon>add_circle</mat-icon><span>Crear ticket</span>
              </button>

              <ng-container *ngIf="isBossOrAdmin">
                <button class="action-button primary-button" (click)="openCreateTopicDialog()" mat-raised-button>
                  <mat-icon>topic</mat-icon><span>Crear tópico</span>
                </button>
                <button class="action-button" routerLink="/help-topics" mat-raised-button>
                  <mat-icon>help</mat-icon><span>Ver tópicos</span>
                </button>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
