<div class="modern-topic-container">
  <div class="topic-backdrop">
    <div class="topic-content">
      <!-- Header -->
      <div class="topic-header">
        <div class="header-icon">
          <mat-icon>help_outline</mat-icon>
        </div>
        <div class="header-content">
          <h1 class="topic-title">Editar Tema de Ayuda</h1>
          <p class="topic-subtitle">Modifica la información del tema de ayuda</p>
        </div>
      </div>

      <!-- Body -->
      <div class="topic-body">
        <form [formGroup]="topicForm" (ngSubmit)="onUpdate()">
          <div class="topic-info">
            <!-- Nombre del Tema -->
            <div class="info-row single-field">
              <div class="form-field">
                <div class="field-label">
                  <mat-icon>label</mat-icon>
                  <span>Nombre del Tema</span>
                </div>
                <mat-form-field appearance="fill" class="modern-input">
                  <mat-label>Nombre del Tema</mat-label>
                  <input matInput formControlName="name" placeholder="Ej. Instalación de Aplicación" />
                </mat-form-field>
              </div>
            </div>

            <!-- Organización y Departamento -->
            <div class="info-row">
              <div class="form-field">
                <div class="field-label">
                  <mat-icon>business</mat-icon>
                  <span>Organización</span>
                </div>
                <mat-form-field appearance="fill" class="modern-input">
                  <mat-label>Organización</mat-label>
                  <mat-select formControlName="organization" (selectionChange)="onOrganizationChange($event.value)" required>
                    <mat-option *ngFor="let org of organizations" [value]="org._id">{{ org.name }}</mat-option>
                  </mat-select>
                  <mat-hint>Selecciona una organización</mat-hint>
                </mat-form-field>
              </div>

              <div class="form-field">
                <div class="field-label">
                  <mat-icon>apartment</mat-icon>
                  <span>Departamento</span>
                </div>
                <mat-form-field appearance="fill" class="modern-input">
                  <mat-label>Departamento</mat-label>
                  <mat-select formControlName="department">
                    <mat-option *ngFor="let dept of departments" [value]="dept._id">
                      {{ dept.name }}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="topicForm.get('department')?.invalid && topicForm.get('department')?.touched">
                    El departamento es requerido.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <!-- Tiempo de ejecución -->
            <div class="info-row single-field">
              <div class="form-field">
                <div class="field-label">
                  <mat-icon>schedule</mat-icon>
                  <span>Tiempo de Ejecución</span>
                </div>
                <mat-form-field appearance="fill" class="modern-input">
                  <mat-label>Tiempo de ejecución (minutos)</mat-label>
                  <input matInput type="number"
                         formControlName="expIn"
                         placeholder="Tiempo para terminar la tarea"
                         minlength="0"
                         min="0"
                         step="5"
                         (keydown)="preventDecimal($event)"
                         (input)="calculateHours($event)"
                  />
                  <mat-hint *ngIf="hours < 1 && topicForm.get('expIn')?.value > 0">
                    {{ topicForm.get('expIn')?.value }} minuto{{ topicForm.get('expIn')?.value == 1 ? '' : 's' }}
                  </mat-hint>
                  <mat-hint *ngIf="hours > 0">
                    {{ hours }} hora{{ hours > 1 ? 's' : '' }}
                  </mat-hint>
                  <mat-error>
                    Asegurese de llenar correctamente el campo
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <!-- Etiquetas -->
            <div class="info-row single-field">
              <div class="form-field">
                <div class="field-label">
                  <mat-icon>local_offer</mat-icon>
                  <span>Etiquetas</span>
                </div>
                <div class="chip-container">
                  <mat-chip-list #chipList aria-label="Etiquetas seleccionadas">
                    <mat-chip *ngFor="let tag of tags" [selectable]="true" [removable]="true" (removed)="removeTag(tag)">
                      {{ tag }}
                      <button mat-icon-button *ngIf="true" (click)="removeTag(tag)">
                        <mat-icon>cancel</mat-icon>
                      </button>
                    </mat-chip>
                    <input matInput
                           [formControl]="tagsControl"
                           [matChipInputFor]="chipList"
                           [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                           (matChipInputTokenEnd)="addTag($event)"
                           placeholder="Añadir etiqueta"
                    />
                  </mat-chip-list>
                </div>
                <small style="color: #6c757d; font-size: 12px; margin-top: 4px; display: block;">
                  Presiona Enter para añadir una etiqueta
                </small>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Actions -->
      <div class="topic-actions">
        <button type="button" class="cancel-btn" (click)="onCancel()">
          <mat-icon>close</mat-icon>
          Cancelar
        </button>
        <button type="button" class="save-btn" (click)="onUpdate()">
          <mat-icon>save</mat-icon>
          Actualizar
        </button>
      </div>
    </div>
  </div>
</div>
