<div class="modern-edit-topic-container">
  <div class="form-header">
    <div class="header-icon">
      <mat-icon>edit</mat-icon>
    </div>
    <div class="header-text">
      <h1 class="dialog-title">Editar Tema de Ayuda</h1>
      <p class="dialog-subtitle">Modifica la información del tema de ayuda</p>
    </div>
  </div>

  <div class="dialog-body">
    <form [formGroup]="topicForm" (ngSubmit)="onUpdate()">
      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Nombre del Tema</mat-label>
          <input matInput formControlName="name" placeholder="Ej. Instalación de Aplicación" />
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Organización</mat-label>
          <mat-select formControlName="organization" (selectionChange)="onOrganizationChange($event.value)" required>
            <mat-option *ngFor="let org of organizations" [value]="org._id">{{ org.name }}</mat-option>
          </mat-select>
          <mat-hint>Selecciona una organización</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Departamento</mat-label>
          <mat-select formControlName="department">
            <mat-option *ngFor="let dept of departments" [value]="dept._id">
              {{ dept.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="topicForm.get('department')?.invalid && topicForm.get('department')?.touched">
            El departamento es requerido.
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Tiempo de ejecución</mat-label>
          <input matInput type="number"
                 formControlName="expIn"
                 placeholder="Tiempo para terminar la tarea"
                 minlength="0"
                 min="0"
                 step="5"
                 (keydown)="preventDecimal($event)"
                 (input)="calculateHours($event)"
          />
          <mat-hint>Tiempo de ejecución</mat-hint>

          <mat-hint *ngIf="hours < 1 && topicForm.get('expIn')?.value > 0" align="end">
            {{ topicForm.get('expIn')?.value }} minuto{{ topicForm.get('expIn')?.value == 1 ? '' : 's' }}
          </mat-hint>

          <mat-hint *ngIf="hours > 0"
                    align="end"
          >{{ hours }} hora{{ hours > 1 ? 's' : '' }}
          </mat-hint>

          <mat-error>
            Asegurese de llenar correctamente el campo
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>Etiquetas</mat-label>
          <mat-chip-list #chipList aria-label="Etiquetas seleccionadas">
            <mat-chip *ngFor="let tag of tags" [selectable]="true" [removable]="true" (removed)="removeTag(tag)">
              {{ tag }}
              <button mat-icon-button *ngIf="true" (click)="removeTag(tag)">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip>
            <input matInput
                   [formControl]="tagsControl"
                   [matChipInputFor]="chipList"
                   [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                   (matChipInputTokenEnd)="addTag($event)"
                   placeholder="Añadir etiqueta"
            />
          </mat-chip-list>
          <mat-hint>Presiona Enter para añadir una etiqueta</mat-hint>
        </mat-form-field>
      </div>
    </form>
  </div>

  <div class="dialog-actions">
    <button type="button" class="cancel-btn" (click)="onCancel()">
      <mat-icon>close</mat-icon>
      Cancelar
    </button>
    <button type="button" class="save-btn" (click)="onUpdate()">
      <mat-icon>save</mat-icon>
      Actualizar
    </button>
  </div>
</div>
