<div class="modern-dialog-container">
  <div class="dialog-backdrop">
    <div class="dialog-content">
      <!-- Header with gradient -->
      <div class="dialog-header">
        <div class="header-icon">
          <mat-icon>swap_horiz</mat-icon>
        </div>
        <div class="header-content">
          <h2 class="dialog-title">Cambiar Estado del Ticket</h2>
          <p class="dialog-subtitle">Actualiza el estado del ticket y añade justificación si es necesario</p>
        </div>
      </div>

      <!-- Body content -->
      <div class="dialog-body">
        <form autocomplete="off" [formGroup]="ticketForm" (ngSubmit)="changeStatus()" class="modern-form">
          
          <!-- Status Selection -->
          <div class="form-group">
            <label class="form-label">
              <mat-icon>label</mat-icon>
              Nuevo Estado
            </label>
            <mat-form-field appearance="outline" class="modern-select">
              <mat-icon matPrefix>flag</mat-icon>
              <mat-label>Selecciona el estado</mat-label>
              <mat-select 
                formControlName="status" 
                (selectionChange)="ticketForm.get('cancellationComment')?.setValue(ticketForm.get('status')?.value === 'Cancelado / Anulado' ? '' : 'No hay justificación')"
                panelClass="modern-autocomplete">
                <mat-option *ngFor="let status of statuses" [value]="status" class="status-option">
                  <div class="option-content">
                    <div class="option-icon status-icon" [ngClass]="getStatusClass(status)">
                      <mat-icon>{{getStatusIcon(status)}}</mat-icon>
                    </div>
                    <span class="option-text">{{status}}</span>
                  </div>
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Cancellation Comment (conditional) -->
          <div class="form-group" *ngIf="ticketForm.get('status')?.value === 'Cancelado / Anulado'">
            <label class="form-label">
              <mat-icon>comment</mat-icon>
              Justificación de Cancelación
            </label>
            <mat-form-field appearance="outline" class="modern-input">
              <mat-icon matPrefix>edit_note</mat-icon>
              <mat-label>Explica el motivo de la cancelación</mat-label>
              <textarea 
                matInput 
                required="true" 
                formControlName="cancellationComment" 
                placeholder="Describe el motivo por el cual se cancela este ticket..."
                rows="3">
              </textarea>
              <mat-error *ngIf="ticketForm.get('cancellationComment')?.invalid">
                La justificación es requerida para cancelaciones
              </mat-error>
            </mat-form-field>
          </div>

        </form>
      </div>

      <!-- Action buttons -->
      <div class="dialog-actions">
        <button 
          type="button" 
          class="btn-secondary"
          mat-dialog-close>
          <mat-icon>close</mat-icon>
          Cancelar
        </button>
        
        <button 
          type="submit"
          class="apply-btn"
          [disabled]="!ticketForm.valid || isSubmitting"
          (click)="changeStatus()">
          <mat-icon>check_circle</mat-icon>
          <span *ngIf="!isSubmitting">Aplicar Cambio</span>
          <span *ngIf="isSubmitting">Aplicando...</span>
          <div class="loading-spinner" *ngIf="isSubmitting">
            <mat-icon class="spin">sync</mat-icon>
          </div>
        </button>
      </div>
    </div>
  </div>
</div>
