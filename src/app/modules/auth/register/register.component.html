<div class="register-container">
  <mat-card class="register-card">
    <mat-card-header>
      <mat-card-title>
        <h2>Registro</h2>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="onRegisterSubmit()">

        <mat-form-field appearance="outline">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="firstName" required>
          <mat-error
            *ngIf="form.get('firstName')?.invalid && (form.get('firstName')?.touched || form.get('firstName')?.dirty)">
            El nombre es requerido.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Apellido</mat-label>
          <input matInput formControlName="lastName" required>
          <mat-error
            *ngIf="form.get('lastName')?.invalid && (form.get('lastName')?.touched || form.get('lastName')?.dirty)">
            El apellido es requerido.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" required email>
          <mat-error *ngIf="form.get('email')?.invalid && (form.get('email')?.touched || form.get('email')?.dirty)">
            <ng-container *ngIf="form.get('email')?.hasError('required')">El email es requerido.</ng-container>
            <ng-container *ngIf="form.get('email')?.hasError('email')">Email inválido.</ng-container>
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Contraseña</mat-label>
          <input matInput type="password" formControlName="password" required>
          <mat-error
            *ngIf="form.get('password')?.invalid && (form.get('password')?.touched || form.get('password')?.dirty)">
            La contraseña es requerida.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Rol</mat-label>
          <mat-select formControlName="role" required>
            <mat-option *ngFor="let role of roles" [value]="role.value">
              {{ role.label }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="form.get('role')?.invalid && (form.get('role')?.touched || form.get('role')?.dirty)">
            El rol es requerido.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Jefe</mat-label>
          <input type="text" matInput [matAutocomplete]="auto" formControlName="boss" (input)="filterUsers($event)">
          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayUserName">
            <mat-option *ngFor="let user of filteredUsers" [value]="user._id">
              {{ user.firstName }} {{ user.lastName }}
            </mat-option>
          </mat-autocomplete>
          <mat-error *ngIf="form.get('boss')?.invalid && (form.get('boss')?.touched || form.get('boss')?.dirty)">
            Se requiere seleccionar un jefe.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Avatar</mat-label>
          <input type="file" (change)="onFileSelected($event)" accept="image/*" style="display: none;" #fileInput>
          <mat-icon matPrefix (click)="fileInput.click()">attach_file</mat-icon>
          <input matInput placeholder="Selecciona un archivo" [value]="avatarName" readonly>
          <mat-error *ngIf="form.get('avatar')?.invalid && (form.get('avatar')?.touched || form.get('avatar')?.dirty)">
            Se requiere seleccionar un avatar.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Departamento</mat-label>
          <mat-select formControlName="departments" multiple>
            <mat-option *ngFor="let depa of departments" [value]="depa._id">
              {{ depa.name }} - {{ depa.organization.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-checkbox formControlName="reporter">Reporter</mat-checkbox>
        <br>

        <button mat-raised-button color="accent" type="submit">Registrar</button>
        <button mat-raised-button type="button" color="warn" (click)="cancel()">Cancelar</button>

      </form>
    </mat-card-content>
  </mat-card>
</div>